import hid
import time

VID = 0x07C0  #Vendor-ID
PID = 0x0181  #Producr-ID
T_INTERFACE = 5  # IO-Interface of Wk100

# ========================================
# Search for KeyWarrior and return 'path'
# for IO-Interface (interface 5)
# ========================================
print("Searching for KeyWarrior100")

target_device = None
for d in hid.enumerate():
    if d['vendor_id'] == VID and d['product_id'] == PID:
        interface_number = d.get('interface_number', -1)
        print(f"Found: {d['product_string']} by interface {interface_number}")
        if interface_number == T_INTERFACE:
            target_device = d
            break

if not target_device:
    print("No KeyWarrior100 found")
    exit(1)

# ========================================
# Open HID and connect to KeyWarrior100
# ========================================
print(f"Connect to KeyWarrior100 using interface {T_INTERFACE}...")
device = hid.device()
device.open_path(target_device['path'])
print("Device connected:", device.get_product_string())

# ========================================
# Report 0x28 – Digital LED enable (WS2812B timing)
# ========================================
report = bytes([
    0x28,
    0x01,
    0x3C,
    0x13,
    0x3C,
    0x26,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
    0x00, 0x00
])

device.write(report)


# ========================================
# Report 0x29 – send LED data
# ========================================
report = ([
    0x29, #report_ID
    0x80, #block
    0x03, 0x00,#LED count
    0xFF, 0x00, 0x00, #led data for 1st LED RGB
    0x00, 0xFF, 0x00, #led data for 2nd LED RGB
    0x00, 0x00, 0xFF, #led data for 3rd LED RGB
    0x00, 0x00, 0x00, #led data for 4th LED RGB
    0x00, 0x00, 0x00, #...
    0x00, 0x00, 0x00,
    0x00, 0x00, 0x00,
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00, 
    0x00, 0x00, 0x00  
])

device.write(report)


device.close()
print("KeyWarrior100 interface closed/free")
